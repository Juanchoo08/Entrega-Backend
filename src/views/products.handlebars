<div class="container">
    <h1>Productos</h1>
    <div id="products">
    {{#each products}}
        <div class="product-card">
        <h3>{{this.title}}</h3>
        <p>{{this.description}}</p>
        <p>Precio: ${{this.price}}</p>
        <p>Stock: {{this.stock}}</p>
        <button class="addToCart" data-id="{{this._id}}">Agregar al carrito</button>
        <a href="/products/{{this._id}}">Ver</a>
        </div>
    {{/each}}
    </div>

    <div class="pagination">
    {{#if hasPrevPage}}<a href="{{prevLink}}">Anterior</a>{{/if}}
    <span>Página {{page}} / {{totalPages}}</span>
    {{#if hasNextPage}}<a href="{{nextLink}}">Siguiente</a>{{/if}}
    </div>
</div>

<script>
  // Al hacer click en agregar al carrito -> POST a /api/carts/:cid/product/:pid
  // Para simplificar usaremos un carrito fijo: crealo por Postman y poné su id aquí.
    const CART_ID = "691f9eba0af7879c3a16a09a";
    document.querySelectorAll(".addToCart").forEach(btn => {
    btn.addEventListener("click", async () => {
        const pid = btn.dataset.id;
        const res = await fetch(`/api/carts/${CART_ID}/product/${pid}`, { method: "POST" });
        const data = await res.json();
        if(data.status === "success") alert("Producto agregado!");
        else alert("Error: " + (data.message || "ver consola"));
    });
    });
</script>
